<!doctype html>
<html xmlns:th="https://www.thymeleaf.org" th:replace="~{modules/layout :: html(content = ~{::content}, showAside = false, pageTitle = (${theme.config.plugins?.photos?.title} ?: '图库'))}">
  <th:block th:fragment="content">
    <!-- 页面头部 -->
    <div class="page-header">
      <h1 class="page-title text-creative">
        <span class="icon-[ph--images-bold]"></span>
        <span th:text="${theme.config.plugins?.photos?.title} ?: '图库'">图库</span>
      </h1>
      <p class="page-desc" th:text="${theme.config.plugins?.photos?.description} ?: '记录生活中的美好瞬间'">记录生活中的美好瞬间</p>
    </div>

    <!-- Preact 图库组件挂载点 -->
    <div id="photo-gallery-root" class="photos-container"></div>

    <!-- 传递数据并挂载 Preact 组件 -->
    <script th:inline="javascript">
      (function() {
        const groups = /*[[${groups}]]*/ [];
        // 转换数据格式
        const formattedGroups = groups.map(group => ({
          name: group.metadata.name,
          displayName: group.spec.displayName,
          photoCount: group.status?.photoCount || group.photos?.length || 0,
          photos: (group.photos || []).map(photo => ({
            url: photo.spec.url,
            cover: photo.spec.cover,
            displayName: photo.spec.displayName,
            description: photo.spec.description
          }))
        }));

        // 等待 DOM 和 JS 加载完成
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', mount);
        } else {
          mount();
        }

        function mount() {
          const container = document.getElementById('photo-gallery-root');
          if (container && window.mountPhotoGallery) {
            window.mountPhotoGallery(container, formattedGroups);
          }
        }
      })();
    </script>
  </th:block>
</html>
